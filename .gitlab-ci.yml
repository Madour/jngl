gcc:
  image: base/archlinux
  stage: build
  script:
    - pacman -Syu --needed --noconfirm meson sdl2 pkg-config fontconfig glew libwebp openal libvorbis boost gcc
    - meson build
    - ninja -C build

clang:
  image: base/archlinux
  stage: build
  script:
    - pacman -Syu --needed --noconfirm meson sdl2 pkg-config fontconfig glew libwebp openal libvorbis boost clang-tools-extra python2
    - CC=clang CXX=clang++ meson build
    - cd build
    - TERM=xterm script -qfc "ninja" /dev/null
    - sed -i s/-pipe// compile_commands.json
    - TERM=xterm script -qfc "/usr/share/clang/run-clang-tidy.py 2>/dev/null" | sed s_$PWD/__
    - '! grep -Fq "error:" typescript'

mingw:
  image: fedora:27
  stage: build
  script:
    - dnf install -y gcc-c++ meson mingw64-pkg-config mingw64-libvorbis mingw64-SDL2 mingw64-fontconfig mingw64-libjpeg-turbo mingw64-libwebp mingw64-boost mingw64-dlfcn mingw64-glew mingw64-openal-soft wine-core
    - meson build --cross-file mingw.ini
    - ninja -C build
